<% content_for :javascript do %>
  <%= javascript_include_tag 'events/new', 'effects', 'controls',
                    "/fiscal_years/#{@fiscal_year.id}/accounts" %>
<% end %>

<% if @event.errors.any? %>
  <ul>
    <% @event.errors.full_messages.each do |msg| %>
      <li><%= msg %></li>
    <% end %>
  </ul>
<% end %>

<%= form_for([@fiscal_year, @event], :html => {:id => "event_form"}) do |f| %>
  <p>
    <label for="event_description">Description:</label> <%= f.text_field(:description, :size => 40) %>
  </p>

  <p>
    <label for="event_receipt_number">Receipt Number:</label> <%= f.text_field(:receipt_number, :size => 4) %>
  </p>

  <p>
    <label for="event_event_date">Date:</label> <%= f.text_field :event_date, :size => 12, :class => "date" %>
  </p>

  <ul class="event_lines">
    <li>
      <h4>
        <span class="debit">
          Debit
        </span>
        <span class="credit">
          Credit
        </span>
      </h4>
    </li>

    <% @lines.each_with_index do |line, idx| %>
      <% line.id = idx + 1 if line.id.blank? %>
      <li>
      <%= f.fields_for(:event_lines, line) do |f2| %>
        <span class="account">
          <%= f2.select(:account_id, @accounts.map{|a| [a.title, a.id]}, :include_blank => true) %>
        </span>
        <span class="debit">
          <%= f2.text_field :debit, :size => 8, :value => trimmed(line.debit) %>
        </span>
        <span class="credit">
          <%= f2.text_field :credit, :size => 8, :value => trimmed(line.credit) %>
        </span>
      <% end %>
      </li>
    <% end %>
  </ul>

  <p>
    <%= submit_tag @event.new_record? ? "Create" : "Save" %>
  </p>
<% end %>
